<beast version='2.0'
       namespace='beast.core
                 :beast.core.util
                 :beast.core.parameter
                 :beast.evolution.alignment
                 :beast.evolution.operators
                 :beast.evolution.sitemodel
                 :beast.evolution.substitutionmodel
                 :beast.evolution.tree
                 :beast.evolution.tree.coalescent
                 :beast.math.distributions
                 :beast.util
                 :bacter
                 :bacter.model:bacter.model.restricted
                 :bacter.operators:bacter.operators.restricted
                 :bacter.util'>


  <!-- Initial simulated ACG -->  

  <input spec='SimulatedRestrictedACG' id='acg'
         rho="0.0005" delta="50.0" sequenceLength="10000"
	 outputFileName="simulated_acg.nexus">
      <populationModel spec='ConstantPopulation' popSize="1.0"/>
      <trait spec='TraitSet' id="timeTrait" traitname="date-backward">
        <taxa spec='TaxonSet'>
          <taxon spec='Taxon' id="t1"/>
          <taxon spec='Taxon' id="t2"/>
          <taxon spec='Taxon' id="t3"/>
          <taxon spec='Taxon' id="t4"/>
          <taxon spec='Taxon' id="t5"/>
        </taxa>
        t1=0.0,
        t2=0.1,
        t3=0.2,
        t4=0.3,
        t5=0.4
      </trait>
  </input>


  <run spec="MCMC" id="mcmc" chainLength="10000000">
    <state>
      <stateNode idref="acg"/>
    </state>

    <!-- Tacget distribution -->
    <distribution spec='RestrictedACGCoalescent' id="prior">
      <rho spec='RealParameter' value='0.0005' id='rho' estimate="false"/>
      <delta spec='RealParameter' value='50.0' id='delta' estimate="false"/>
      <acg idref="acg"/>
      <populationModel spec='ConstantPopulation' id='popModel'>
        <popSize spec='RealParameter' value="1.0" id="popSize" estimate="false"/>
      </populationModel>
    </distribution>

    <!-- ACG operators -->

    <operator id="addRemove" spec="AddRemoveConversion" weight="1.0">
        <acg idref="acg"/>
        <rho idref="rho"/>
        <delta idref="delta"/>
        <populationModel idref="popModel"/>
    </operator>

    <operator id="mergeSplit" spec="MergeSplitConversion" weight="1.0"
              expectedGapSize="200" acg="@acg" />
    
    <operator id="scale" spec="ACGScaler" weight="1.0"
              scaleFactor="0.8">
        <acg idref="acg"/>
    </operator>

    <operator id="CFRSwap" spec="ClonalFrameConversionSwap" weight="1.0"
              acg="@acg" populationModel="@popModel"/>
    
    <operator id="CRswap" spec="ConvertedRegionSwap" weight="1.0"
              acg="@acg"/>

    <operator id="CRshift" spec="ConvertedRegionShift" weight="1.0"
              acg="@acg" apertureSize="0.01" />

    <operator id="CRBshift" spec="ConvertedRegionBoundaryShift" weight="1.0"
              acg="@acg" apertureSize="0.01" />

    <operator id="REhop" spec="ConvertedEdgeHop" weight="1.0"
              acg="@acg" />

   <operator id="REflip" spec="ConvertedEdgeFlip" weight="1.0"
              acg="@acg" />

    <operator id="REslide" spec="ConvertedEdgeSlide" weight="1.0"
              acg="@acg" scaleBound="0.8" />
    
    <operator id="Uniform" spec='ACGValidityWrapper' acg="@acg" weight="1">
        <operator spec='Uniform' weight="10">
            <tree idref="acg"/>
        </operator>
    </operator>
    <operator id="STS" spec='ACGValidityWrapper' acg="@acg" weight="1">
        <operator spec='SubtreeSlide' weight="5" gaussian="true" size="1.0">
            <tree idref="acg"/>
        </operator>
    </operator>
    <operator id="STXnarrow" spec='ACGValidityWrapper' acg="@acg" weight="1">
        <operator id='narrow' spec='Exchange' isNarrow='true' weight="1">
            <tree idref="acg"/>
        </operator>
    </operator>
    <operator id="STXwide" spec='ACGValidityWrapper' acg="@acg" weight="1">
        <operator id='wide' spec='Exchange' isNarrow='false' weight="1">
            <tree idref="acg"/>
        </operator>
    </operator>
    <operator id="WB" spec='ACGValidityWrapper' acg="@acg" weight="1">
        <operator spec='WilsonBalding' weight="1">
            <tree idref="acg"/>
        </operator>
    </operator>

   
    <!-- Output logging -->

    <logger logEvery="10000">
      <log idref="prior"/>
      <log spec='TreeHeightLogger' tree="@acg"/>
    </logger>

    <logger logEvery="100" fileName="$(filebase).log">
      <log idref="prior"/>
      <log spec='TreeHeightLogger' tree="@acg"/>
    </logger>

    <!--logger logEvery="1000" fileName="$(filebase).trees" mode="tree">
      <log idref="acg"/>
    </logger>

    <logger logEvery="1000" fileName="$(filebase).cf" mode="tree">
      <log spec="ClonalFrameLogger" acg="@acg"/>
    </logger>
	 
    <logger logEvery="100" fileName="$(filebase).converted">
      <model idref="prior"/>
      <log spec="ConvertedRegionLogger" acg="@acg"/>
    </logger-->

    <logger logEvery="100" fileName="$(filebase).stats">
      <log spec="ConversionGraphStatsLogger" acg="@acg"/>
    </logger>

  </run>

</beast>
